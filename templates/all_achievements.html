<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>All Achievements - Achievement Management System</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />

    <!-- External JS -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <!-- Filter Script -->
    <script>
        function filterAchievements() {
            const filter = document.getElementById("typeFilter").value.toLowerCase();
            const rows = document.querySelectorAll(".achievement-row");

            rows.forEach(row => {
                const type = row.dataset.type.toLowerCase();

                if (filter === "all" || type.includes(filter)) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }
    </script>

    <!-- Page Specific Styles -->
    <style>
        .dashboard-container {
            max-width: 1100px !important;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .back-button {
            text-decoration: none;
            color: var(--primary-color);
        }

        .filter-box {
            margin-bottom: 20px;
        }

        .filter-box select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .achievements-table {
            width: 100%;
            border-collapse: collapse;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .achievements-table th,
        .achievements-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .achievement-type-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .view-button {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
        }

        .certificate-link {
            color: var(--primary-color);
            text-decoration: none;
        }

        .certificate-link:hover {
            text-decoration: underline;
        }

        .no-achievements {
            text-align: center;
            padding: 30px;
            background: var(--glass-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .achievement-count {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .export-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 9px 20px;
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(22, 163, 74, 0.3);
            transition: all 0.25s ease;
            white-space: nowrap;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(22, 163, 74, 0.45);
        }

        .export-btn:active {
            transform: translateY(0);
        }

        .filter-box select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--glass-bg);
            color: var(--text-color);
            font-size: 14px;
        }
    </style>
</head>

<body style="height:auto; align-items:flex-start; padding-top:80px;">

    <div class="toggle-container">
        <button id="mode-toggle">Dark Mode üåô</button>
    </div>

    <div class="container dashboard-container">

        <div class="page-header">
            <div class="title">All Recorded Achievements</div>
            <a href="{{ url_for('teacher-dashboard') }}" class="back-button">
                ‚Üê Back to Dashboard
            </a>
        </div>

        <div class="content">

            <!-- Toolbar: Filter + Count + Export -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <div class="filter-box" style="margin-bottom:0;">
                        <label><b>Filter:</b></label>
                        <select id="typeFilter" onchange="filterAchievements()">
                            <option value="all">All Types</option>
                            <option value="hackathon">Hackathon</option>
                            <option value="coding">Coding Competition</option>
                            <option value="paper">Paper Presentation</option>
                            <option value="conference">Conference</option>
                            <option value="symposium">Symposium</option>
                        </select>
                    </div>
                    {% if achievements %}
                    <span class="achievement-count">{{ achievements | length }} record(s)</span>
                    {% endif %}
                </div>

                {% if achievements %}
                <a href="{{ url_for('export-csv') }}" class="export-btn" title="Download all achievements as CSV">
                    üì• Export CSV
                </a>
                {% endif %}
            </div>

            {% if achievements %}
            <table class="achievements-table">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Type</th>
                        <th>Event</th>
                        <th>Date</th>
                        <th>Position</th>
                        <th>Certificate</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for achievement in achievements %}
                    <tr class="achievement-row"
                        data-type="{{ achievement.achievement_type }}">

                        <td>
                            {{ achievement.student_name }} 
                            ({{ achievement.student_id }})
                        </td>

                        <td>
                            <span class="achievement-type-badge">
                                {{ achievement.achievement_type }}
                            </span>
                        </td>

                        <td>{{ achievement.event_name }}</td>
                        <td>{{ achievement.achievement_date }}</td>
                        <td>{{ achievement.position }}</td>

                        <td>
                            {% if achievement.certificate_path %}
                                <a href="{{ url_for('static', filename=achievement.certificate_path) }}"
                                   class="certificate-link"
                                   target="_blank">
                                    View
                                </a>
                            {% else %}
                                -
                            {% endif %}
                        </td>

                        <td>
                            <a href="#" class="view-button">Details</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
                <div class="no-achievements">
                    <h3>No achievements recorded yet.</h3>
                </div>
            {% endif %}

        </div>
    </div>

</body>
</html>
